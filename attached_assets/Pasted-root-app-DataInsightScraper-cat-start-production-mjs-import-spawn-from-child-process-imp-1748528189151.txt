root@app:~/DataInsightScraper# cat start-production.mjs
import { spawn } from 'child_process';
import { fileURLToPath } from 'url';
import { dirname } from 'path';
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
// Set environment variables
process.env.__dirname = __dirname;
process.env.PWD = __dirname;
// Start the server using npx tsx directly
const server = spawn('npx', ['tsx', 'server/index.ts'], {
  stdio: 'inherit',
  env: process.env,
  cwd: __dirname
});
server.on('error', (err) => {
  console.error('Failed to start server:', err);
  process.exit(1);
});
server.on('close', (code) => {
  console.log(`Server process exited with code ${code}`);
  process.exit(code);
});
root@app:~/DataInsightScraper# cat ecosystem.config.cjs
module.exports = {
  apps: [
    {
      name: "promellon",
      script: "start-production.mjs",
      interpreter: "node",
      env: {
        NODE_ENV: "production",
        DATABASE_URL: "postgresql://taskscout_una:6qsX7ptGPiA1@10.15.0.29:5432/monitoring",
        PORT: "5000",
        ZEPTOMAIL_API_KEY: "yA6KbHtf7l/wkDgGRxNr15mK9dpi+a08j36y4i22fsAlf9izj6E4hEVvItbuJjWIi4TYs/kHOt8YcYywvNsNe5hnZIAHLJTGTuv4P2uV48xh8ciEYNYihp+gCrESG6BMdh8nAyk1RPcgWA==",
        SESSION_SECRET: "b2fd7e336d841d9eb00f06e7dba3b15ea408bab723205e3e297cb2bc7b732412",
        ENTRA_TENANT_ID: "d5bc17d2-4910-4403-86b9-672f3274f2f9",
        ENTRA_CLIENT_ID: "68a40cd7-8e6f-482d-9b6e-e53cf1da6e62",
        ENTRA_CLIENT_SECRET: "pLT8Q~en74tEXa6V4yWanV_U9J.cJvqTVFfB6dhb",
        UPLOAD_PATH: "uploads"
      }
    }
  ]
};
root@app:~/DataInsightScraper# pm2 logs promellon
[TAILING] Tailing last 15 lines for [promellon] process (change the value with --lines option)
/root/.pm2/logs/promellon-out.log last 15 lines:
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1
0|promello | Server process exited with code 1

/root/.pm2/logs/promellon-error.log last 15 lines:
0|promello |
0|promello | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
0|promello |     at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)
0|promello |     at new NodeError (node:internal/errors:405:5)
0|promello |     at validateString (node:internal/validators:162:11)
0|promello |     at Object.resolve (node:path:1115:7)
0|promello |     at <anonymous> (/root/DataInsightScraper/vite.config.ts:21:19)
0|promello |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
0|promello |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
0|promello |     at async loadESM (node:internal/process/esm_loader:34:7)
0|promello |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
0|promello |   code: 'ERR_INVALID_ARG_TYPE'
0|promello | }
0|promello |
0|promello | Node.js v18.20.8

0|promellon  | Server process exited with code 1
^C
root@app:~/DataInsightScraper#
