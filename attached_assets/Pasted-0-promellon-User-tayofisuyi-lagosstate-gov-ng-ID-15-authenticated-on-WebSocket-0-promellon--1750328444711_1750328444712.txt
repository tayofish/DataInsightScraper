0|promellon  | User tayofisuyi@lagosstate.gov.ng (ID: 15) authenticated on WebSocket
0|promellon  | Storage: Creating notification with data: {"userId":4,"title":"New direct message","message":"Tayo Fisuyi sent you a message: \"hi\"","type":"direct_message","referenceId":72,"referenceType":"direct_message","isRead":false}
0|promellon  | Storage: Failed to create notification: error: null value in column "userId" of relation "notifications" violates not-null constraint
0|promellon  |     at /root/DataInsightScraper/node_modules/pg-pool/index.js:45:11
0|promellon  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|promellon  |     at <anonymous> (/root/DataInsightScraper/node_modules/src/node-postgres/session.ts:104:19)
0|promellon  |     at Object.createNotification (/root/DataInsightScraper/server/storage.ts:1176:33)
0|promellon  |     at <anonymous> (/root/DataInsightScraper/server/routes.ts:5648:9) {
0|promellon  |   length: 357,
0|promellon  |   severity: 'ERROR',
0|promellon  |   code: '23502',
0|promellon  |   detail: 'Failing row contains (134, 4, New direct message, Tayo Fisuyi sent you a message: "hi", direct_message, 72, direct_message, f, 2025-06-19 10:20:22.50728, null, f, null, null).',
0|promellon  |   hint: undefined,
0|promellon  |   position: undefined,
0|promellon  |   internalPosition: undefined,
0|promellon  |   internalQuery: undefined,
0|promellon  |   where: undefined,
0|promellon  |   schema: 'public',
0|promellon  |   table: 'notifications',
0|promellon  |   column: 'userId',
0|promellon  |   dataType: undefined,
0|promellon  |   constraint: undefined,
0|promellon  |   file: 'execMain.c',
0|promellon  |   line: '1982',
0|promellon  |   routine: 'ExecConstraints'
0|promellon  | }
0|promellon  | Storage: Database constraint violation - userId mapping issue
0|promellon  | Storage: Input data was: {"userId":4,"title":"New direct message","message":"Tayo Fisuyi sent you a message: \"hi\"","type":"direct_message","referenceId":72,"referenceType":"direct_message","isRead":false}
0|promellon  | Storage: Attempting fallback SQL insert for notification
0|promellon  | Storage: Fallback notification creation also failed: error: null value in column "userId" of relation "notifications" violates not-null constraint
0|promellon  |     at /root/DataInsightScraper/node_modules/pg-pool/index.js:45:11
0|promellon  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|promellon  |     at Object.createNotification (/root/DataInsightScraper/server/storage.ts:1193:26)
0|promellon  |     at <anonymous> (/root/DataInsightScraper/server/routes.ts:5648:9) {
0|promellon  |   length: 358,
0|promellon  |   severity: 'ERROR',
0|promellon  |   code: '23502',
0|promellon  |   detail: 'Failing row contains (135, 4, New direct message, Tayo Fisuyi sent you a message: "hi", direct_message, 72, direct_message, f, 2025-06-19 10:20:22.534904, null, f, null, null).',
0|promellon  |   hint: undefined,
0|promellon  |   position: undefined,
0|promellon  |   internalPosition: undefined,
0|promellon  |   internalQuery: undefined,
0|promellon  |   where: undefined,
0|promellon  |   schema: 'public',
0|promellon  |   table: 'notifications',
0|promellon  |   column: 'userId',
0|promellon  |   dataType: undefined,
0|promellon  |   constraint: undefined,
0|promellon  |   file: 'execMain.c',
0|promellon  |   line: '1982',
0|promellon  |   routine: 'ExecConstraints'
0|promellon  | }
0|promellon  | Broadcasting real-time message via HTTP route: 72
0|promellon  | Sent new message notification to receiver: 4
0|promellon  | Sent confirmation to sender: 15
0|promellon  | Sent new message notification to receiver: 4
0|promellon  | Sent confirmation to sender: 15
0|promellon  | 11:20:22 AM [express] POST /api/direct-messages/4 201 in 81ms :: {"id":72,"senderId":15,"receiverId":…
0|promellon  | 11:20:22 AM [express] GET /api/direct-messages/4 200 in 19ms :: [{"id":72,"senderId":15,"receiverId":…
0|promellon  | 11:20:22 AM [express] GET /api/direct-messages/conversations 200 in 51ms :: [{"user":{"id":4,"usernam…
0|promellon  | WebSocket connection established
0|promellon  | User gbolarinwa@lagosstate.gov.ng (ID: 28) authenticated on WebSocket

